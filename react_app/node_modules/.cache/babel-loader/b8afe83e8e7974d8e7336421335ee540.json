{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\BB\\\\Desktop\\\\Chen\\\\Dev\\\\visual_stock_v2\\\\react_app\\\\src\\\\widget.js\";\nimport React, { useState } from 'react';\nimport PriceTrending from './market_data.js';\nimport MyContext from './my_context.js';\nimport { Button } from '@material-ui/core';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nconst base_widget = {\n  display: 'flex',\n  flexDirection: 'column',\n  width: '100%',\n  height: '100%',\n  backgroundColor: 'yellow'\n};\nconst title = {\n  backgroundColor: 'orange',\n  padding: '1vh',\n  fontFamily: 'Arial, Helvetica, sans-serif'\n};\nconst nav_bar = {\n  margin: '2vh'\n};\nconst url = 'wss://stream.binance.com/stream?streams=!miniTicker@arr';\nlet isConnected = false;\nlet socket = null;\n\nfunction ControlledTabs(props) {\n  const [key, setKey] = useState('BTC');\n  const index_list = props.indexs;\n\n  if (index_list) {\n    return /*#__PURE__*/React.createElement(Tabs, {\n      value: value,\n      onChange: handleChange,\n      indicatorColor: \"primary\",\n      textColor: \"primary\",\n      variant: \"scrollable\",\n      scrollButtons: \"auto\",\n      \"aria-label\": \"scrollable auto tabs example\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 38,\n        columnNumber: 4\n      }\n    }, index_list.map((item, i) => /*#__PURE__*/React.createElement(Tab, {\n      eventKey: item,\n      title: item,\n      key: i,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 7\n      }\n    })));\n  } else {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 58,\n        columnNumber: 4\n      }\n    }, \"loading ... \");\n  }\n}\n\nclass MarketWidget extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      data_list: null,\n      //steam data\n      tab_index: null,\n      //keys\n      tab_dict: null,\n      //keys and its subkeys\n      key: 'BTC' //current key index\n\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.structure) {\n      this.setState({\n        tab_index: Object.keys(this.props.structure),\n        tab_dict: this.props.structure\n      });\n    }\n  }\n\n  setup_websocket() {\n    return new Promise((resolve, reject) => {\n      let channel = new WebSocket(url);\n\n      channel.onopen = () => {\n        isConnected = true;\n        resolve(channel);\n      };\n\n      channel.onmessage = e => {\n        console.log(e.data);\n        this.setState({\n          data_list: e.data\n        });\n      };\n\n      channel.onerror = e => {\n        reject(e);\n      };\n    });\n  }\n\n  close_websocket(channel) {\n    return new Promise((resolve, reject) => {\n      channel.close();\n\n      channel.onclose = () => {\n        isConnected = false;\n        resolve(null);\n      };\n\n      channel.onerror = e => {\n        reject(e);\n      };\n    });\n  }\n\n  socket_setup() {\n    socket = this.setup_websocket().then(channel => {\n      socket = channel;\n      window.alert('open channel !');\n    }).catch(error => {\n      window.alert('failed to setup !');\n    });\n  }\n\n  websocket_clickhandler() {\n    if (!isConnected) {\n      this.setup_websocket().then(channel => {\n        socket = channel;\n        window.alert('open channel !');\n      }).catch(error => {\n        window.alert('failed to setup !');\n      });\n    } else {\n      this.close_websocket(socket).then(channel => {\n        socket = channel;\n        window.alert('close channel !');\n      }).catch(error => {\n        window.alert('failed to close !');\n      });\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      style: base_widget,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      href: \"#contained-buttons\",\n      onClick: () => this.websocket_clickhandler(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 5\n      }\n    }, \"Pause/Start\"), /*#__PURE__*/React.createElement(\"div\", {\n      style: title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 12\n      }\n    }, \" Market \"))), /*#__PURE__*/React.createElement(\"div\", {\n      style: nav_bar,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 5\n      }\n    }), /*#__PURE__*/React.createElement(PriceTrending, {\n      data_list: this.state.data_list,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 5\n      }\n    }));\n  }\n\n}\n\nexport default MarketWidget;","map":{"version":3,"sources":["C:/Users/BB/Desktop/Chen/Dev/visual_stock_v2/react_app/src/widget.js"],"names":["React","useState","PriceTrending","MyContext","Button","Tabs","Tab","base_widget","display","flexDirection","width","height","backgroundColor","title","padding","fontFamily","nav_bar","margin","url","isConnected","socket","ControlledTabs","props","key","setKey","index_list","indexs","value","handleChange","map","item","i","MarketWidget","Component","constructor","state","data_list","tab_index","tab_dict","componentDidMount","structure","setState","Object","keys","setup_websocket","Promise","resolve","reject","channel","WebSocket","onopen","onmessage","e","console","log","data","onerror","close_websocket","close","onclose","socket_setup","then","window","alert","catch","error","websocket_clickhandler","render"],"mappings":"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","sourcesContent":["import React, { useState } from 'react'\r\nimport PriceTrending from './market_data.js'\r\nimport MyContext from './my_context.js'\r\nimport { Button } from '@material-ui/core'\r\nimport Tabs from '@material-ui/core/Tabs';\r\nimport Tab from '@material-ui/core/Tab';\r\n\r\n\r\nconst base_widget = {\r\n\tdisplay: 'flex',\r\n\tflexDirection: 'column',\r\n\twidth: '100%',\r\n\theight: '100%',\r\n\tbackgroundColor: 'yellow',\r\n}\r\n\r\nconst title = {\r\n\tbackgroundColor: 'orange',\r\n\tpadding: '1vh',\r\n\tfontFamily: 'Arial, Helvetica, sans-serif',\r\n}\r\n\r\nconst nav_bar = {\r\n\tmargin: '2vh',\r\n}\r\n\r\nconst url = 'wss://stream.binance.com/stream?streams=!miniTicker@arr'\r\nlet isConnected = false\r\nlet socket = null\r\n\r\n\r\nfunction ControlledTabs(props) {\r\n\tconst [key, setKey] = useState('BTC');\r\n\tconst index_list = props.indexs\r\n\r\n\tif(index_list) {\r\n\t\treturn (\r\n\t\t\t<Tabs\r\n\t\t\t\tvalue={value}\r\n\t\t\t\tonChange={handleChange}\r\n\t\t\t\tindicatorColor=\"primary\"\r\n\t\t\t\ttextColor=\"primary\"\r\n\t\t\t\tvariant=\"scrollable\"\r\n\t\t\t\tscrollButtons=\"auto\"\r\n\t\t\t\taria-label=\"scrollable auto tabs example\"\r\n\t\t\t>\r\n\t\t\t\t{\t\r\n\t\t\t\t\tindex_list.map((item, i) =>\r\n\t\t\t\t\t\t<Tab eventKey={item} title={item} key={i}></Tab>\r\n\t\t\t\t\t)\r\n\r\n\t\t\t\t}\t\r\n\t\t\t</Tabs>\r\n\t\t)\r\n\t}\r\n\telse {\r\n\t\treturn (\r\n\t\t\t<div>loading ... </div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\n\r\nclass MarketWidget extends React.Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props)\r\n\t\tthis.state = {\r\n\t\t\tdata_list: null, //steam data\r\n\t\t\ttab_index: null, //keys\r\n\t\t\ttab_dict: null,  //keys and its subkeys\r\n\t\t\tkey: 'BTC'\t//current key index\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tif(this.props.structure) {\r\n\t\t\tthis.setState({\r\n\t\t\t\ttab_index: Object.keys(this.props.structure),\r\n\t\t\t\ttab_dict: this.props.structure,\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tsetup_websocket() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tlet channel = new WebSocket(url)\r\n\t\t\tchannel.onopen = () => {\r\n\t\t\t\tisConnected = true\r\n\t\t\t\tresolve(channel)\r\n\t\t\t}\r\n\t\t\tchannel.onmessage = (e) => {\r\n\t\t\t\tconsole.log(e.data)\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tdata_list: e.data\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tchannel.onerror = (e) => {\r\n\t\t\t\treject(e)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tclose_websocket(channel) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tchannel.close()\r\n\t\t\tchannel.onclose = () => {\r\n\t\t\t\tisConnected = false\r\n\t\t\t\tresolve(null)\r\n\t\t\t}\r\n\t\t\tchannel.onerror = (e) => {\r\n\t\t\t\treject(e)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\tsocket_setup() {\r\n\t\tsocket = this.setup_websocket().then(channel => {\r\n\t\t\tsocket = channel\r\n\t\t\twindow.alert('open channel !')\r\n\t\t}).catch(error => {\r\n\t\t\twindow.alert('failed to setup !')\r\n\t\t})\r\n\t}\r\n\r\n\twebsocket_clickhandler() {\r\n\t\tif (!isConnected) {\t\t\r\n\t\t\tthis.setup_websocket().then(channel => {\r\n\t\t\t\tsocket = channel\r\n\t\t\t\twindow.alert('open channel !')\r\n\t\t\t}).catch(error => {\r\n\t\t\t\twindow.alert('failed to setup !')\r\n\t\t\t})\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.close_websocket(socket).then(channel => {\r\n\t\t\t\tsocket = channel\r\n\t\t\t\twindow.alert('close channel !')\r\n\t\t\t}).catch(error => {\r\n\t\t\t\twindow.alert('failed to close !')\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div style = { base_widget }>\r\n\t\t\t\t<Button variant=\"contained\" color=\"primary\" href=\"#contained-buttons\" onClick={() => this.websocket_clickhandler()}>\r\n \t\t\t\t\tPause/Start\r\n\t\t\t\t</Button>\t\t\t\t\r\n\t\t\t\t<div style = { title }>\r\n\t\t\t\t\t<span><h3> Market </h3></span>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style = { nav_bar }>\r\n\r\n\t\t\t\t\t{/* <ControlledTabs indexs={this.state.tab_index}/> */}\r\n\r\n\t\t\t\t</div>\r\n\t\t\t\t<PriceTrending data_list={ this.state.data_list } />\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default MarketWidget;"]},"metadata":{},"sourceType":"module"}