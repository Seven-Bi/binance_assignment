{"ast":null,"code":"var _jsxFileName = \"/Users/bbe/Dev/Module/visual_stock_v2/react_app/src/widget.js\";\nimport React from 'react'; // import PriceTrending from './market_data.js';\n\nconst base_widget = {\n  display: 'flex',\n  flexDirection: 'column',\n  width: '100%',\n  height: '100%',\n  backgroundColor: 'yellow'\n};\nconst title = {\n  backgroundColor: 'orange',\n  padding: '1vh',\n  fontFamily: 'Arial, Helvetica, sans-serif'\n};\nconst nav_bar = {\n  backgroundColor: 'blue',\n  padding: '1vh'\n};\nconst tool_bar = {\n  backgroundColor: 'green',\n  padding: '1vh'\n};\nconst ul_as_bar = {\n  listStyleType: 'none',\n  display: 'flex',\n  flexDirection: 'row',\n  justifyContent: 'space-between',\n  paddingInlineStart: '0'\n};\nconst url = 'wss://stream.binance.com/stream?streams=!miniTicker@arr';\nlet isConnected = false;\nlet socket = null; // let calculate_change = (basedata, data) => {\n// \tvar code = JSON.parse(data).data[0].s\n// \tvar l_price = JSON.parse(data).data[0].c\n// \tbasedata.forEach (\n// \t\ti => {\n// \t\t\tif (i.s === code) {\n// \t\t\t\t//console.log((parseFloat(i.o) - parseFloat(l_price)) / parseFloat(i.o))\n// \t\t\t\treturn (parseFloat(i.o) - parseFloat(l_price)) / parseFloat(i.o)\n// \t\t\t}\n// \t\t}\n// \t)\n// }\n\nlet setup_websocket = callback => {\n  return new Promise((resolve, reject) => {\n    let channel = new WebSocket(url);\n\n    channel.onopen = () => {\n      isConnected = true;\n      resolve(channel);\n    };\n\n    channel.onmessage = e => {\n      // console.log(e.data)\n      callback(e.data); // ref.current.callback(calculate_change(basedata, e.data)) //xxxx\t\n    };\n\n    channel.onerror = e => {\n      reject(e);\n    };\n  });\n};\n\nlet close_websocket = channel => {\n  return new Promise((resolve, reject) => {\n    channel.close();\n\n    channel.onclose = () => {\n      isConnected = false;\n      resolve(null);\n    };\n\n    channel.onerror = e => {\n      reject(e);\n    };\n  });\n};\n\nlet websocket_clickhandler = callback => {\n  if (!isConnected) {\n    setup_websocket(callback).then(channel => {\n      socket = channel;\n      window.alert('open channel !');\n    }).catch(error => {\n      window.alert('failed to setup !');\n    });\n  } else {\n    close_websocket(socket).then(channel => {\n      socket = channel;\n      window.alert('close channel !');\n    }).catch(error => {\n      window.alert('failed to close !');\n    });\n  }\n};\n\nclass MarketWidget extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      real_data: [],\n      cb: null\n    };\n  }\n\n  socket_setup(callback) {\n    // this.setState({api_data: data})\n    socket = setup_websocket().then(channel => {\n      socket = channel;\n      window.alert('open channel !');\n    }).catch(error => {\n      window.alert('failed to setup !');\n    });\n\n    socket.onclose = () => {\n      this.setState({\n        cb: callback\n      });\n      setTimeout(() => {\n        socket = setup_websocket().then(channel => {\n          socket = channel;\n          window.alert('open channel !');\n        }).catch(error => {\n          window.alert('failed to setup !');\n        });\n      }, 4000);\n    };\n\n    socket.onmessage = e => {\n      // console.log(e.data)\n      callback(e.data); // this.ref.current.callback(calculate_change(data, e.data))\n    };\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      style: base_widget,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 12\n      }\n    }, \" Market \")), /*#__PURE__*/React.createElement(\"button\", {\n      onClick: () => websocket_clickhandler(this.state.cb),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 6\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      style: nav_bar,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"ul\", {\n      style: ul_as_bar,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 7\n      }\n    }, \"Margin\"), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 7\n      }\n    }, \"BNB\"), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 7\n      }\n    }, \"BTC\"), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 7\n      }\n    }, \"ALTS\"), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 7\n      }\n    }, \"USD\"))), /*#__PURE__*/React.createElement(\"div\", {\n      style: tool_bar,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 5\n      }\n    }, /*#__PURE__*/React.createElement(\"ul\", {\n      style: ul_as_bar,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 6\n      }\n    }, /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 7\n      }\n    }, \"2\"), /*#__PURE__*/React.createElement(\"li\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 7\n      }\n    }, \"3\"))));\n  }\n\n}\n\nexport default MarketWidget;","map":{"version":3,"sources":["/Users/bbe/Dev/Module/visual_stock_v2/react_app/src/widget.js"],"names":["React","base_widget","display","flexDirection","width","height","backgroundColor","title","padding","fontFamily","nav_bar","tool_bar","ul_as_bar","listStyleType","justifyContent","paddingInlineStart","url","isConnected","socket","setup_websocket","callback","Promise","resolve","reject","channel","WebSocket","onopen","onmessage","e","data","onerror","close_websocket","close","onclose","websocket_clickhandler","then","window","alert","catch","error","MarketWidget","Component","constructor","props","state","real_data","cb","socket_setup","setState","setTimeout","render"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB,C,CACA;;AAIA,MAAMC,WAAW,GAAG;AACnBC,EAAAA,OAAO,EAAE,MADU;AAEnBC,EAAAA,aAAa,EAAE,QAFI;AAGnBC,EAAAA,KAAK,EAAE,MAHY;AAInBC,EAAAA,MAAM,EAAE,MAJW;AAKnBC,EAAAA,eAAe,EAAE;AALE,CAApB;AAQA,MAAMC,KAAK,GAAG;AACbD,EAAAA,eAAe,EAAE,QADJ;AAEbE,EAAAA,OAAO,EAAE,KAFI;AAGbC,EAAAA,UAAU,EAAE;AAHC,CAAd;AAMA,MAAMC,OAAO,GAAG;AACfJ,EAAAA,eAAe,EAAE,MADF;AAEfE,EAAAA,OAAO,EAAE;AAFM,CAAhB;AAKA,MAAMG,QAAQ,GAAG;AAChBL,EAAAA,eAAe,EAAE,OADD;AAEhBE,EAAAA,OAAO,EAAE;AAFO,CAAjB;AAKA,MAAMI,SAAS,GAAG;AACjBC,EAAAA,aAAa,EAAE,MADE;AAEjBX,EAAAA,OAAO,EAAE,MAFQ;AAGjBC,EAAAA,aAAa,EAAE,KAHE;AAIjBW,EAAAA,cAAc,EAAE,eAJC;AAKjBC,EAAAA,kBAAkB,EAAE;AALH,CAAlB;AAUA,MAAMC,GAAG,GAAG,yDAAZ;AACA,IAAIC,WAAW,GAAG,KAAlB;AACA,IAAIC,MAAM,GAAG,IAAb,C,CAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIC,eAAe,GAAIC,QAAD,IAAc;AACnC,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACvC,QAAIC,OAAO,GAAG,IAAIC,SAAJ,CAAcT,GAAd,CAAd;;AACAQ,IAAAA,OAAO,CAACE,MAAR,GAAiB,MAAM;AACtBT,MAAAA,WAAW,GAAG,IAAd;AACAK,MAAAA,OAAO,CAACE,OAAD,CAAP;AACA,KAHD;;AAIAA,IAAAA,OAAO,CAACG,SAAR,GAAqBC,CAAD,IAAO;AAC1B;AACAR,MAAAA,QAAQ,CAACQ,CAAC,CAACC,IAAH,CAAR,CAF0B,CAG1B;AACA,KAJD;;AAKAL,IAAAA,OAAO,CAACM,OAAR,GAAmBF,CAAD,IAAO;AACxBL,MAAAA,MAAM,CAACK,CAAD,CAAN;AACA,KAFD;AAGA,GAdM,CAAP;AAeA,CAhBD;;AAkBA,IAAIG,eAAe,GAAIP,OAAD,IAAa;AAClC,SAAO,IAAIH,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACvCC,IAAAA,OAAO,CAACQ,KAAR;;AACAR,IAAAA,OAAO,CAACS,OAAR,GAAkB,MAAM;AACvBhB,MAAAA,WAAW,GAAG,KAAd;AACAK,MAAAA,OAAO,CAAC,IAAD,CAAP;AACA,KAHD;;AAIAE,IAAAA,OAAO,CAACM,OAAR,GAAmBF,CAAD,IAAO;AACxBL,MAAAA,MAAM,CAACK,CAAD,CAAN;AACA,KAFD;AAGA,GATM,CAAP;AAUA,CAXD;;AAaA,IAAIM,sBAAsB,GAAId,QAAD,IAAc;AAC1C,MAAI,CAACH,WAAL,EAAkB;AACjBE,IAAAA,eAAe,CAACC,QAAD,CAAf,CAA0Be,IAA1B,CAA+BX,OAAO,IAAI;AACzCN,MAAAA,MAAM,GAAGM,OAAT;AACAY,MAAAA,MAAM,CAACC,KAAP,CAAa,gBAAb;AACA,KAHD,EAGGC,KAHH,CAGSC,KAAK,IAAI;AACjBH,MAAAA,MAAM,CAACC,KAAP,CAAa,mBAAb;AACA,KALD;AAMA,GAPD,MAQK;AACJN,IAAAA,eAAe,CAACb,MAAD,CAAf,CAAwBiB,IAAxB,CAA6BX,OAAO,IAAI;AACvCN,MAAAA,MAAM,GAAGM,OAAT;AACAY,MAAAA,MAAM,CAACC,KAAP,CAAa,iBAAb;AACA,KAHD,EAGGC,KAHH,CAGSC,KAAK,IAAI;AACjBH,MAAAA,MAAM,CAACC,KAAP,CAAa,mBAAb;AACA,KALD;AAMA;AACD,CAjBD;;AAoBA,MAAMG,YAAN,SAA2BxC,KAAK,CAACyC,SAAjC,CAA2C;AAC1CC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AAClB,UAAMA,KAAN;AAEA,SAAKC,KAAL,GAAa;AACZC,MAAAA,SAAS,EAAE,EADC;AAEZC,MAAAA,EAAE,EAAE;AAFQ,KAAb;AAIA;;AAEDC,EAAAA,YAAY,CAAC3B,QAAD,EAAW;AACtB;AACAF,IAAAA,MAAM,GAAGC,eAAe,GAAGgB,IAAlB,CAAuBX,OAAO,IAAI;AAC1CN,MAAAA,MAAM,GAAGM,OAAT;AACAY,MAAAA,MAAM,CAACC,KAAP,CAAa,gBAAb;AACA,KAHQ,EAGNC,KAHM,CAGAC,KAAK,IAAI;AACjBH,MAAAA,MAAM,CAACC,KAAP,CAAa,mBAAb;AACA,KALQ,CAAT;;AAOAnB,IAAAA,MAAM,CAACe,OAAP,GAAiB,MAAM;AACtB,WAAKe,QAAL,CAAc;AACbF,QAAAA,EAAE,EAAE1B;AADS,OAAd;AAGA6B,MAAAA,UAAU,CAAC,MAAM;AAChB/B,QAAAA,MAAM,GAAGC,eAAe,GAAGgB,IAAlB,CAAuBX,OAAO,IAAI;AAC1CN,UAAAA,MAAM,GAAGM,OAAT;AACAY,UAAAA,MAAM,CAACC,KAAP,CAAa,gBAAb;AACA,SAHQ,EAGNC,KAHM,CAGAC,KAAK,IAAI;AACjBH,UAAAA,MAAM,CAACC,KAAP,CAAa,mBAAb;AACA,SALQ,CAAT;AAMA,OAPS,EAOP,IAPO,CAAV;AAQA,KAZD;;AAcAnB,IAAAA,MAAM,CAACS,SAAP,GAAoBC,CAAD,IAAO;AACzB;AACAR,MAAAA,QAAQ,CAACQ,CAAC,CAACC,IAAH,CAAR,CAFyB,CAGzB;AACA,KAJD;AAKA;;AAEDqB,EAAAA,MAAM,GAAG;AACR,wBACC;AAAK,MAAA,KAAK,EAAKjD,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACC;AAAK,MAAA,KAAK,EAAKM,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAN,CADD,eAEC;AAAQ,MAAA,OAAO,EAAE,MAAM2B,sBAAsB,CAAC,KAAKU,KAAL,CAAWE,EAAZ,CAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAFD,CADD,eAKC;AAAK,MAAA,KAAK,EAAKpC,OAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACC;AAAI,MAAA,KAAK,EAAKE,SAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADD,eAEC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAFD,eAGC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAHD,eAIC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAJD,eAKC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aALD,CADD,CALD,eAcC;AAAK,MAAA,KAAK,EAAKD,QAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACC;AAAI,MAAA,KAAK,EAAKC,SAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAI;AAAO,MAAA,IAAI,EAAC,MAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAAJ,CADD,eAEC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAFD,eAGC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAHD,CADD,CAdD,CADD;AAyBA;;AAlEyC;;AAqE3C,eAAe4B,YAAf","sourcesContent":["import React from 'react';\n// import PriceTrending from './market_data.js';\n\n\n\nconst base_widget = {\n\tdisplay: 'flex',\n\tflexDirection: 'column',\n\twidth: '100%',\n\theight: '100%',\n\tbackgroundColor: 'yellow',\n}\n\nconst title = {\n\tbackgroundColor: 'orange',\n\tpadding: '1vh',\n\tfontFamily: 'Arial, Helvetica, sans-serif',\n}\n\nconst nav_bar = {\n\tbackgroundColor: 'blue',\n\tpadding: '1vh',\n}\n\nconst tool_bar = {\n\tbackgroundColor: 'green',\n\tpadding: '1vh',\n}\n\nconst ul_as_bar = {\n\tlistStyleType: 'none',\n\tdisplay: 'flex',\n\tflexDirection: 'row',\n\tjustifyContent: 'space-between',\n\tpaddingInlineStart: '0',\n}\n\n\n\nconst url = 'wss://stream.binance.com/stream?streams=!miniTicker@arr'\nlet isConnected = false\nlet socket = null\n\n\n// let calculate_change = (basedata, data) => {\n// \tvar code = JSON.parse(data).data[0].s\n// \tvar l_price = JSON.parse(data).data[0].c\n// \tbasedata.forEach (\n// \t\ti => {\n// \t\t\tif (i.s === code) {\n// \t\t\t\t//console.log((parseFloat(i.o) - parseFloat(l_price)) / parseFloat(i.o))\n// \t\t\t\treturn (parseFloat(i.o) - parseFloat(l_price)) / parseFloat(i.o)\n// \t\t\t}\n// \t\t}\n// \t)\n// }\n\nlet setup_websocket = (callback) => {\n\treturn new Promise((resolve, reject) => {\n\t\tlet channel = new WebSocket(url)\n\t\tchannel.onopen = () => {\n\t\t\tisConnected = true\n\t\t\tresolve(channel)\n\t\t}\n\t\tchannel.onmessage = (e) => {\n\t\t\t// console.log(e.data)\n\t\t\tcallback(e.data)\n\t\t\t// ref.current.callback(calculate_change(basedata, e.data)) //xxxx\t\n\t\t}\n\t\tchannel.onerror = (e) => {\n\t\t\treject(e)\n\t\t}\n\t})\n}\n\nlet close_websocket = (channel) => {\n\treturn new Promise((resolve, reject) => {\n\t\tchannel.close()\n\t\tchannel.onclose = () => {\n\t\t\tisConnected = false\n\t\t\tresolve(null)\n\t\t}\n\t\tchannel.onerror = (e) => {\n\t\t\treject(e)\n\t\t}\n\t})\n}\n\nlet websocket_clickhandler = (callback) => {\n\tif (!isConnected) {\t\t\n\t\tsetup_websocket(callback).then(channel => {\n\t\t\tsocket = channel\n\t\t\twindow.alert('open channel !')\n\t\t}).catch(error => {\n\t\t\twindow.alert('failed to setup !')\n\t\t})\n\t}\n\telse {\n\t\tclose_websocket(socket).then(channel => {\n\t\t\tsocket = channel\n\t\t\twindow.alert('close channel !')\n\t\t}).catch(error => {\n\t\t\twindow.alert('failed to close !')\n\t\t})\n\t}\n}\n\n\nclass MarketWidget extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\n\t\tthis.state = {\n\t\t\treal_data: [],\n\t\t\tcb: null\n\t\t}\n\t}\n\n\tsocket_setup(callback) {\n\t\t// this.setState({api_data: data})\n\t\tsocket = setup_websocket().then(channel => {\n\t\t\tsocket = channel\n\t\t\twindow.alert('open channel !')\n\t\t}).catch(error => {\n\t\t\twindow.alert('failed to setup !')\n\t\t})\n\n\t\tsocket.onclose = () => {\n\t\t\tthis.setState({\n\t\t\t\tcb: callback\n\t\t\t})\n\t\t\tsetTimeout(() => {\n\t\t\t\tsocket = setup_websocket().then(channel => {\n\t\t\t\t\tsocket = channel\n\t\t\t\t\twindow.alert('open channel !')\n\t\t\t\t}).catch(error => {\n\t\t\t\t\twindow.alert('failed to setup !')\n\t\t\t\t})\n\t\t\t}, 4000);\n\t\t}\n\n\t\tsocket.onmessage = (e) => {\n\t\t\t// console.log(e.data)\n\t\t\tcallback(e.data)\n\t\t\t// this.ref.current.callback(calculate_change(data, e.data))\n\t\t}\n\t}\n\t\n\trender() {\n\t\treturn (\n\t\t\t<div style = { base_widget }>\n\t\t\t\t<div style = { title }>\n\t\t\t\t\t<span><h3> Market </h3></span>\n\t\t\t\t\t<button onClick={() => websocket_clickhandler(this.state.cb)}/>\n\t\t\t\t</div>\n\t\t\t\t<div style = { nav_bar }>\n\t\t\t\t\t<ul style = { ul_as_bar }>\n\t\t\t\t\t\t<li>Margin</li>\n\t\t\t\t\t\t<li>BNB</li>\n\t\t\t\t\t\t<li>BTC</li>\n\t\t\t\t\t\t<li>ALTS</li>\n\t\t\t\t\t\t<li>USD</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t<div style = { tool_bar }>\n\t\t\t\t\t<ul style = { ul_as_bar }>\n\t\t\t\t\t\t<li><input type=\"text\" /></li>\n\t\t\t\t\t\t<li>2</li>\n\t\t\t\t\t\t<li>3</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nexport default MarketWidget;"]},"metadata":{},"sourceType":"module"}